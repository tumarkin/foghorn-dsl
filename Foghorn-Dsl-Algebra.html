<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Foghorn.Dsl.Algebra</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">foghorn-dsl-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Rob Tumarkin 2025</td></tr><tr><th>License</th><td>Non-commercial use only</td></tr><tr><th>Maintainer</th><td>https://github.com/tumarkin</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Foghorn.Dsl.Algebra</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Variables</a></li><li><a href="#g:2">Operations</a></li><li><a href="#g:3">Type Erasure</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides the algebraic foundation for Foghorn's econometric DSL,
defining the core types and operations for creating and transforming variables.</p><h1>Overview</h1><p>The Algebra layer is the foundation of Foghorn's type-safe econometric DSL.
It provides:</p><ol><li value="1">**Variable Types** - Type-indexed representations of econometric data</li><li value="2">**Operations Language** - Functions and combinators for creating and transforming variables</li><li value="3">**Type Erasure** - Converting typed variables to runtime-manipulable forms</li></ol><p><strong>Note:</strong> Direct handling of <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:EVar" title="Foghorn.Dsl.Algebra.Var.Internal">EVar</a></code> and <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:XVar" title="Foghorn.Dsl.Algebra.Var.Internal">XVar</a></code> types is generally not necessary
for end users. The language automatically manages type-level tracking and type
erasure. Most users only need the operations from <a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a>
to build variables.</p><h1>Architecture</h1><p>The Algebra layer consists of three main components:</p><h2>1. Variables (<a href="Foghorn-Dsl-Algebra-Var.html">Foghorn.Dsl.Algebra.Var</a>)</h2><p>Defines the core variable types with type-level tracking:</p><ul><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:EVar" title="Foghorn.Dsl.Algebra.Var.Internal">EVar</a></code> - Type-indexed econometric variable</li><li>Carries source, index structure, and data type at the type level</li><li>Ensures compile-time correctness of operations</li><li>Created via DSL operations, not direct construction</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:XVar" title="Foghorn.Dsl.Algebra.Var.Internal">XVar</a></code> - Type-erased variable with singleton evidence</li><li>Runtime-manipulable representation</li><li>Preserves type information through singletons</li><li>Enables dynamic variable handling</li></ul><pre>-- Type-indexed variable
type MyVar d = EVar XCoficatVar (Panel Permno_ TradingDate_) d

stockPrice :: MyVar Float_
stockPrice = Crsp.dsf.prc

-- Type-erased for runtime manipulation
erasedPrice :: XVar XCoficatVar
erasedPrice = exorcise stockPrice
</pre><h2>2. Operations (<a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a>)</h2><p>Provides the core operations for variables:</p><ul><li><strong>Constants</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:int_" title="Foghorn.Dsl.Algebra.Operations">int_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:float_" title="Foghorn.Dsl.Algebra.Operations">float_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:date_" title="Foghorn.Dsl.Algebra.Operations">date_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:text_" title="Foghorn.Dsl.Algebra.Operations">text_</a></code></li><li><strong>Logic</strong> - Boolean operations and comparisons</li><li><strong>Time Series</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:lag1_" title="Foghorn.Dsl.Algebra.Operations">lag1_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:forward1_" title="Foghorn.Dsl.Algebra.Operations">forward1_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:lagN_" title="Foghorn.Dsl.Algebra.Operations">lagN_</a></code></li><li><strong>Aggregations</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:mean_" title="Foghorn.Dsl.Algebra.Operations">mean_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:max_" title="Foghorn.Dsl.Algebra.Operations">max_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:standardDeviation_" title="Foghorn.Dsl.Algebra.Operations">standardDeviation_</a></code></li><li><strong>Transformations</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:ln_" title="Foghorn.Dsl.Algebra.Operations">ln_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:abs_" title="Foghorn.Dsl.Algebra.Operations">abs_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:square_" title="Foghorn.Dsl.Algebra.Operations">square_</a></code></li><li><strong>Date/Time</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:extractYear_" title="Foghorn.Dsl.Algebra.Operations">extractYear_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:offsetDate_" title="Foghorn.Dsl.Algebra.Operations">offsetDate_</a></code></li><li><strong>Reindexing</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:reindex" title="Foghorn.Dsl.Algebra.Operations">reindex</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:reindexX" title="Foghorn.Dsl.Algebra.Operations">reindexX</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:reindexT" title="Foghorn.Dsl.Algebra.Operations">reindexT</a></code></li><li><strong>Peer Groups</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:meanOfPeers_" title="Foghorn.Dsl.Algebra.Operations">meanOfPeers_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:where1_" title="Foghorn.Dsl.Algebra.Operations">where1_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:by1_" title="Foghorn.Dsl.Algebra.Operations">by1_</a></code></li><li><strong>Subsampling</strong> - <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:subsample_" title="Foghorn.Dsl.Algebra.Operations">subsample_</a></code>, <code><a href="Foghorn-Dsl-Algebra-Operations.html#v:union_" title="Foghorn.Dsl.Algebra.Operations">union_</a></code></li></ul><pre>-- Create derived variables
logPrice = ln_ Crsp.dsf.prc
laggedReturn = lag1_ Crsp.dsf.ret
industryMean = mean_ @Industry_ Comp.fundamentalData.assets

-- Variables support standard operators
priceChange = Crsp.dsf.prc - lag1_ Crsp.dsf.prc
returnVolatility = standardDeviation_ @TradingDate_ Crsp.dsf.ret
</pre><h2>3. Type Erasure (<a href="Foghorn-Dsl-Algebra-Exorcism.html">Foghorn.Dsl.Algebra.Exorcism</a>)</h2><p>Implements the <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Exorcise" title="Foghorn.Dsl.Algebra.Var.Internal">Exorcise</a></code> type class for converting typed structures
to type-erased equivalents:</p><ul><li>Enables runtime manipulation of typed variables</li><li>Preserves type information through singleton evidence</li><li>Propagates recursively through composite structures</li></ul><p>This is primarily used internally by the transpiler when converting
typed specifications to database queries.</p><h1>Design Philosophy</h1><p>The Algebra layer follows these principles:</p><ol><li value="1">**Type Safety** - Index structures and data types checked at compile time</li><li value="2">**Composability** - Operations compose naturally with standard Haskell operators</li><li value="3">**Declarative** - Variables describe &quot;what&quot; not &quot;how&quot;</li><li value="4">**Transparent** - Type-level information guides but doesn't obstruct</li></ol><h1>Usage Patterns</h1><h2>Creating Variables</h2><p>Variables are created through three main paths:</p><ol><li value="1"><strong>Data Sources</strong> - Import from datasets (e.g., <code>Crsp.dsf.prc</code>)</li><li value="2"><strong>Operations</strong> - Transform existing variables (e.g., <code>ln_ price</code>)</li><li value="3"><strong>Constants</strong> - Create literal values (e.g., <code>float_ 1.0</code>)</li></ol><pre>-- From data source
price = Crsp.dsf.prc

-- Via transformation
logPrice = ln_ price

-- As constant
threshold = float_ 100.0
</pre><h2>Type-Level Tracking</h2><p>Variables carry their properties at the type level:</p><pre>type StockVar d = EVar XCoficatVar (Panel Permno_ TradingDate_) d

-- Compiler knows this is Float_ with Panel structure
returns :: StockVar Float_
returns = Crsp.dsf.ret

-- Compiler enforces compatible operations
laggedReturns = lag1_ returns  -- &#10003; OK - preserves panel structure
</pre><h2>Standard Operators</h2><p>Variables support standard Haskell operators through type class instances:</p><pre>-- Numeric operators
excess = returns - riskFreeRate
scaled = returns * float_ 100.0

-- Comparisons
isPositive = returns &gt; float_ 0.0
isExtreme = abs_ returns &gt; float_ 0.1

-- Logical operators
qualified = isPositive &amp;&amp; isLarge
</pre><h1>Module Organization</h1><p>This module re-exports the key components:</p><ul><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:EVar" title="Foghorn.Dsl.Algebra.Var.Internal">EVar</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:XVar" title="Foghorn.Dsl.Algebra.Var.Internal">XVar</a></code> - Core variable types</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:ToXVar" title="Foghorn.Dsl.Algebra.Var.Internal">ToXVar</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Exorcise" title="Foghorn.Dsl.Algebra.Var.Internal">Exorcise</a></code> - Type classes for type conversion and erasure</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Subsample" title="Foghorn.Dsl.Algebra.Var.Internal">Subsample</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Source-39-Var" title="Foghorn.Dsl.Algebra.Var.Internal">Source'Var</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:OffsetDateType" title="Foghorn.Dsl.Algebra.Var.Internal">OffsetDateType</a></code> - Supporting types</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#v:xEconType" title="Foghorn.Dsl.Algebra.Var.Internal">xEconType</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#v:xEconIndices" title="Foghorn.Dsl.Algebra.Var.Internal">xEconIndices</a></code> - Type information extraction functions</li><li>All operations from <a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a></li></ul><p>For detailed documentation on specific functionality, see the individual
sub-modules:</p><ul><li><a href="Foghorn-Dsl-Algebra-Var.html">Foghorn.Dsl.Algebra.Var</a> - Variable type definitions and type classes</li><li><a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a> - Variable operations and transformations</li><li><a href="Foghorn-Dsl-Algebra-Exorcism.html">Foghorn.Dsl.Algebra.Exorcism</a> - Type erasure instances</li></ul><h1>See Also</h1><ul><li><a href="Foghorn-Dsl-Language.html">Foghorn.Dsl.Language</a> - Specification language for defining analyses</li><li><a href="Foghorn-Dsl-Estimator.html">Foghorn.Dsl.Estimator</a> - Regression and estimation specifications</li><li><a href="file:///Users/roberttumarkin/Coding/foghorn-public/dist-newstyle/build/aarch64-osx/ghc-9.10.1/foghorn-base-0.1.0.0/doc/html/foghorn-base/Foghorn-Base.html">Foghorn.Base</a> - Foundational types (indices, economic types)</li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short">module <a href="Foghorn-Dsl-Algebra-Var.html">Foghorn.Dsl.Algebra.Var</a></li><li class="src short">module <a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a></li><li class="src short">module <a href="Foghorn-Dsl-Algebra-Exorcism.html">Foghorn.Dsl.Algebra.Exorcism</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Variables</h1></a><div class="doc"><p>Core variable types with type-level index tracking.</p><ul><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:EVar" title="Foghorn.Dsl.Algebra.Var.Internal">EVar</a></code> - Type-indexed econometric variables</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:XVar" title="Foghorn.Dsl.Algebra.Var.Internal">XVar</a></code> - Type-erased variables with singleton evidence</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:ToXVar" title="Foghorn.Dsl.Algebra.Var.Internal">ToXVar</a></code> - Type class for converting to XVar</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Exorcise" title="Foghorn.Dsl.Algebra.Var.Internal">Exorcise</a></code> - Type class for type erasure</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Subsample" title="Foghorn.Dsl.Algebra.Var.Internal">Subsample</a></code> - Type for subsampling operations</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:Source-39-Var" title="Foghorn.Dsl.Algebra.Var.Internal">Source'Var</a></code> - Type for variable sources</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#t:OffsetDateType" title="Foghorn.Dsl.Algebra.Var.Internal">OffsetDateType</a></code> - Type for date offset operations</li><li><code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#v:xEconType" title="Foghorn.Dsl.Algebra.Var.Internal">xEconType</a></code>, <code><a href="Foghorn-Dsl-Algebra-Var-Internal.html#v:xEconIndices" title="Foghorn.Dsl.Algebra.Var.Internal">xEconIndices</a></code> - Functions to extract type information</li></ul><p>See <a href="Foghorn-Dsl-Algebra-Var.html">Foghorn.Dsl.Algebra.Var</a> for the public interface and
 <a href="Foghorn-Dsl-Algebra-Var-Internal.html">Foghorn.Dsl.Algebra.Var.Internal</a> for implementation details.</p></div><div class="top"><p class="src">module <a href="Foghorn-Dsl-Algebra-Var.html">Foghorn.Dsl.Algebra.Var</a></p></div><a href="#g:2" id="g:2"><h1>Operations</h1></a><div class="doc"><p>Core operations for creating and transforming variables.</p><p>See <a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a> for complete list of operations.</p></div><div class="top"><p class="src">module <a href="Foghorn-Dsl-Algebra-Operations.html">Foghorn.Dsl.Algebra.Operations</a></p></div><a href="#g:3" id="g:3"><h1>Type Erasure</h1></a><div class="doc"><p>Type class instances for converting typed variables to runtime forms.</p><p>See <a href="Foghorn-Dsl-Algebra-Exorcism.html">Foghorn.Dsl.Algebra.Exorcism</a> for implementation details.</p></div><div class="top"><p class="src">module <a href="Foghorn-Dsl-Algebra-Exorcism.html">Foghorn.Dsl.Algebra.Exorcism</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.28.0</p></div></body></html>